<!-- NAVBAR -->
<nav class="navbar">
  <button class="nav-btn" routerLink="/menu">Inicio</button>
  <button class="nav-btn" routerLink="/publicar-proyectos">Publicar Proyecto</button>
  <div class="nav-username">
    <a [routerLink]="['/mi-perfil']">{{ nombreCompleto }}</a>
  </div>
  <button class="nav-btn" routerLink="/canales">Canales</button>
  <button class="nav-btn logout" (click)="logout()">Cerrar Sesión</button>
</nav>

<section class="activities-card">
  <h2>Postulaciones Recibidas</h2>

  <!-- FILTRO -->
<div class="filtro-container">
  <label for="filtroEstado"><strong>Filtrar por estado:</strong></label>
  <select id="filtroEstado" (change)="filtrarPorEstado($any($event.target).value)">
    <option value="PENDIENTE">Pendiente</option>
    <option value="ACEPTADA">Aceptada</option>
    <option value="RECHAZADA">Rechazada</option>
    <option value="CANCELADA">Cancelada</option>
  </select>

  <label for="filtroOportunidad"><strong>Filtrar por oportunidad:</strong></label>
  <select id="filtroOportunidad" (change)="filtrarPorOportunidad($any($event.target).value)">
    <option value="">Seleccionar oportunidad</option>
    <option *ngFor="let oportunidad of oportunidades" [value]="oportunidad.idOportunidad">
      {{ oportunidad.titulo }}
    </option>
  </select>
</div>


  <div *ngIf="loading" class="loading">Cargando...</div>
  <div *ngIf="error" class="error">Error cargando postulaciones</div>

 <!-- CABECERA -->
<div class="table-head" [ngClass]="{ 'sin-acciones': !hayPendientes }">
  <span>Oportunidad</span>
  <span>Postulante</span>
  <span>Estado</span>
  <span>Historial</span>
  <span>Fecha</span>
  <span *ngIf="hayPendientes">Acciones</span>
</div>

<!-- FILAS -->
<div *ngFor="let p of postulaciones"
     class="row"
     [ngClass]="{ 'sin-acciones': p.estado !== 'PENDIENTE' }">

  <!-- Oportunidad -->
  <div>{{ p.oportunidad.titulo }}</div>

  <!-- Postulante -->
  <div>
  <button class="btn-postulante" (click)="abrirPerfil(p)">
    {{ p.postulante.nombre }} {{ p.postulante.apellido }}
  </button>
</div>


  <!-- Estado -->
  <div class="estado" [ngClass]="p.estado.toLowerCase()">
    {{ p.estado }}
  </div>

  <!-- Historial -->
  <div>
    <button class="btn-historial" (click)="abrirHistorial(p)">
      Ver Historial
    </button>
  </div>

  <!-- Fecha -->
  <div>{{ p.fechaPostulacion | date:'yyyy-MM-dd' }}</div>

  <!-- Acciones (solo si está pendiente) -->
  <div *ngIf="p.estado === 'PENDIENTE'" class="acciones">
      <button class="btn-aceptar" (click)="cambiarEstado(p, 'ACEPTADA')">
        Aceptar
      </button>
      <button class="btn-rechazar" (click)="rechazarConMotivo(p)">
        Rechazar
      </button>
  </div>

</div>

<!-- MENSAJE SIN DATOS -->
<div *ngIf="!loading && postulaciones.length === 0" class="loading">
  No hay postulaciones aún.
</div>

</section>

<app-historial-postulacion
  [visible]="historialVisible"
  [postulacion]="postulacionSeleccionada"
  (cerrar)="cerrarHistorial()">
</app-historial-postulacion>

<app-perfil-postulante
  [visible]="perfilVisible"
  [idUsuario]="perfilData?.idUsuario"
  (cerrar)="cerrarPerfil()">
</app-perfil-postulante>
